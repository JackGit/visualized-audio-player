function initPlaylist(){Player.add("石进 - 夜的钢琴曲五 - Demo版纯音乐","./audio/石进 - 夜的钢琴曲五 - Demo版纯音乐.mp3"),Player.add("4 Non Blondes - What's Up","./audio/4 Non Blondes - What's Up.mp3","./lrc/what's up.lrc"),Player.add("danny mccarthy、mark petrie - rags to rings","./audio/danny mccarthy、mark petrie - rags to rings.mp3"),Player.add("Jasper Forks - River Flows In You","./audio/Jasper Forks - River Flows In You - SIngle MG Mix版纯音乐.mp3"),Player.add("Ludovico Einaudi - Experience","./audio/Ludovico Einaudi - Experience - 纯音乐版.mp3"),Player.add("N2V - Yearning(Original Mix)","./audio/N2V - Yearning(Original Mix).mp3"),Player.add("Delacey - Dream It Possible","audio/Delacey - Dream It Possible.mp3","lrc/Dream It Possible.lrc"),Player.add("Fifth Harmony、kid Ink - Worth It","audio/Fifth Harmony、kid Ink - Worth It.mp3","lrc/Worth it.lrc"),Player.add("t.A.T.u. - 30 Minutes","audio/t.A.T.u. - 30 Minutes.mp3","lrc/30 Minutes.lrc"),Player.add("房东的猫 - 美好事物","audio/房东的猫 - 美好事物.mp3","lrc/美好事物.lrc"),Player.add("这个年纪-齐一","audio/这个年纪-齐一.mp3","lrc/这个年纪.lrc")}var Tools={toDoubleDigits:function(a){var b=a.toString();return b.length<2&&(b="0"+b),b},toTime:function(a){return this.toDoubleDigits(Math.floor(a/60))+":"+this.toDoubleDigits(Math.floor(a%60))},addStyleBufferAnimate:function(a,b,c,d){function e(a,b){return a.currentStyle?a.currentStyle[b]:getComputedStyle(a,!1)[b]}clearInterval(a.timer),a.timer=setInterval(function(){var c=!0;for(var f in b){var g=0;g="opacity"==f?100*parseFloat(e(a,f)):parseInt(e(a,f));var h=(b[f]-g)/10;h=h>0?Math.ceil(h):Math.floor(h),g!=b[f]&&(c=!1),"opacity"==f?(a.style.filter="alpha(opacity):"+(g+h)+")",a.style.opacity=(g+h)/100):a.style[f]=g+h+"px"}c&&(clearInterval(a.timer),d&&d())},c)},addDomBufferAnimate:function(a,b,c,d){clearInterval(a.timer),a.timer=setInterval(function(){var c=!0;for(var e in b){var f=a[e],g=(b[e]-f)/10;g=g>0?Math.ceil(g):Math.floor(g),f!=b[e]&&(c=!1),a[e]=f+g}c&&(clearInterval(a.timer),d&&d())},c)},random:function(a,b){return Math.round(Math.random()*(b-a)+a)},loadLyric:function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="text",d.onload=function(){if(this.status>=200&&this.status<300||304==this.status){var a=d.responseText;b&&b(a)}else c&&c()},d.send()},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){event.preventDefault?event.preventDefault():event.returnValue=!1}},Player={audioObj:null,currentID:0,playList:[],cycle:2,init:function(){this.audioObj=new Audio},add:function(a,b,c){this.playList.push({name:a,url:b,lyricUrl:c||null})},remove:function(a){delete this.playList[a]},setCycle:function(a){a=Math.floor(a%3),this.cycle=a},isPause:function(){return this.audioObj.paused},load:function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="blob",d.onload=function(){if(this.status>=200&&this.status<300||304==this.status){var a=URL.createObjectURL(this.response);b&&b(a)}else c&&c()},d.send()},play:function(a){var b=this.playList[a];if(null!=b)if(4==this.audioObj.readyState&&this.currentID==a)this.audioObj.play();else{this.currentID=a,this.pause();var c=b.url,d=this;this.load(c,function(a){d.audioObj.src=a,d.audioObj.load(),d.audioObj.play()})}return b},pause:function(){this.audioObj.pause()},playStep:function(a){if(this.playList.length<1)return null;if(null==this.currentID)return this.play(0);var b=this.currentID+a;return b=b>this.playList.length-1?b%this.playList.length:b,b=0>b?this.playList.length-1:b,this.play(b)},next:function(){var a;switch(this.cycle){case 0:case 1:a=1;break;case 2:a=Tools.random(1,this.playList.length-1)}return this.playStep(a)},prev:function(){return this.playStep(-1)},ended:function(){var a;switch(this.cycle){case 0:a=1;break;case 1:a=0;break;case 2:a=Tools.random(1,this.playList.length-1)}return this.playStep(a)}},AudManager={ctx:null,analyser:null,gain:null,source:null,init:function(){try{this.ctx=new AudioContext}catch(a){this.ctx=null,console.log("Your browser can't support Audio API!")}null!==this.ctx&&this.ctx instanceof AudioContext&&(this.source=this.ctx.createMediaElementSource(Player.audioObj),this.gain=this.ctx.createGain(),this.analyser=this.ctx.createAnalyser(),this.source.connect(this.gain),this.gain.connect(this.analyser),this.analyser.connect(this.ctx.destination),this.analyser.smoothingTimeConstant=.7,this.analyser.fftSize=128)},setGain:function(a){this.gain.gain.value=a},setSmooth:function(a){this.analyser.smoothingTimeConstant=a},getData:function(a){}},Drawer={ctx:null,width:0,height:0,Dots:[],drawIndex:5,size:function(){return null!==AudManager.analyser?AudManager.analyser.fftSize/4:0}(),animateID:null,init:function(a){this.ctx=a.getContext("2d"),this.width=a.offsetWidth,this.height=a.offsetHeight},setSize:function(a){this.size=a,AudManager.analyser.fftSize=4*this.size},setSmooth:function(a){AudManager.analyser.smoothingTimeConstant=a},visualizer:function(){function a(){AudManager.analyser.getByteFrequencyData(d),b.ctx.clearRect(-1e3,-1e3,b.width+1e3,b.height+1e3),c(d),Monitor.update(),b.animateID=requestAnimationFrame(a)}var b=this;window.cancelAnimationFrame(this.animateID);var c,d=new Uint8Array(this.size);switch(this.ctx.fillStyle="",this.ctx.strokeStyle="",this.ctx.shadowBlur=0,this.drawIndex){case 0:this.addLineargrandient(),this.getDots(),c=function(a){b.columnDraw(a)};break;case 1:this.getDots(),c=function(a){b.bubbleDraw(a)};break;case 2:this.setSmooth(.85),this.addShadow(),c=function(a){b.phosphorDraw(a)};break;case 3:this.setSmooth(.9),this.addLineargrandient(),c=function(a){b.squareDraw(a)};break;case 5:this.setSmooth(.9),this.getDots(),c=function(a){b.spiralDraw(a)}}Monitor.start(),requestAnimationFrame(a),c(d)},getDots:function(){this.Dots=[];for(var a=0;a<this.size;a++){var b=Tools.random,c=b(0,this.width),d=b(0,this.height),e=b(2,5),f=b(2,5),g="rgba("+b(200,255)+","+b(66,200)+","+b(66,200)+","+b(.6,1)+")",h="rgba("+b(200,255)+","+b(66,200)+","+b(66,200)+","+b(.1,.5)+")";this.Dots.push({x:c,y:d,dx:e,dy:f,color:g,color2:h,cap:0})}},addLineargrandient:function(){var a=this.ctx.createLinearGradient(0,this.height,0,0);a.addColorStop(0,"#ff9966"),a.addColorStop(.5,"#99ff66"),a.addColorStop(.8,"#9966ff"),a.addColorStop(1,"#6699ff"),this.ctx.fillStyle=a},columnDraw:function(a){var b=.6*this.width/this.size;b=b>20?20:b;for(var c=.1*this.height,d=0;d<this.size;d++){var e=this.Dots[d],f=Math.floor(d*this.width/this.size),g=.8*(Math.floor((d+1)*this.width/this.size)-f),h=a[d]/256*(this.height-b),i=.5+(e.cap-h)/(.2*this.height);e.cap-=i,e.cap<0&&(e.cap=0),h>0&&h+c>e.cap&&(e.cap=h+c),e.cap>this.height-b&&(e.cap=this.height-b),this.ctx.fillRect(f,this.height,g,-h),this.ctx.fillRect(f,this.height-e.cap,g,-b)}},bubbleDraw:function(a){for(var b=0;b<this.size;b++){var c=this.Dots[b],d=6+a[b]/256*(this.height>this.width?this.width:this.height)/10,e=this.ctx.createRadialGradient(c.x,c.y,0,c.x,c.y,d);e.addColorStop(0,c.color2),e.addColorStop(1,c.color),this.ctx.beginPath(),this.ctx.arc(c.x,c.y,d,0,2*Math.PI,!0),this.ctx.fillStyle=e,this.ctx.fill(),c.x+=c.dx,c.x=c.x>this.width?0:c.x}},addShadow:function(){this.ctx.shadowColor="#0033ff",this.ctx.shadowBlur=1,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.fillStyle="white"},phosphorDraw:function(a){this.ctx.fillRect(0,this.height/2+1,this.width,-1);var b=.6*this.width/this.size;b=b>20?20:b;for(var c=(.1*this.height,0);c<this.size;c++){var d=Math.floor(c*this.width/this.size),e=.6*(Math.floor((c+1)*this.width/this.size)-d),f=a[c]/256*(this.height-b);this.ctx.fillRect(d,this.height/2+f/2,e,-f)}},squareDraw:function(a){var b=.6*this.width/this.size;b=b>20?20:b;for(var c=(.1*this.height,Math.round(this.width/this.size)),d=0;d<this.size;d++)for(var e=d*c,f=a[d]/256*(this.height-b),g=0;f/c>g;g++)this.ctx.fillStyle="rgba("+Math.floor(d/this.size*256)+","+a[d]+","+g*c/f*256+",1)",this.ctx.fillRect(e,this.height-c*g,.9*c,-.9*c)},getDots2:function(){this.Dots=[];for(var a=0;a<this.size;a++){var b=2+2*Math.random(),c=-(2+2*Math.random());this.Dots.push({x:0,y:200,dx:b,dy:c,color:"",color2:"",cap:1})}},spiralDraw:function(a){this.ctx.lineWidth=2;var b=10;this.ctx.translate(this.width/2,this.height/2);for(var c=0,d=[0],e=0,f=1;e<this.size;e++)e==f*this.size/8-1&&(d.push(c),f++),c+=a[e];for(var e=1;e<d.length;e++)d[e-1]=8*(d[e]-d[e-1])/this.size;this.ctx.beginPath();for(var e=0;e<this.size;e++)this.ctx.strokeStyle="rgba("+parseInt(255-a[e])+",255,"+parseInt(255-c)+",1)",b=100+a[e]/256*((this.height>this.width?this.width:this.height)-200)/2,this.ctx.moveTo(b,0),this.ctx.arc(0,0,b,0,2*Math.PI,!0);this.ctx.stroke(),b=100,this.ctx.beginPath(),this.ctx.rotate(.2*Math.PI/this.size);for(var e=0;e<this.size;e++)this.ctx.fillStyle="rgba("+parseInt(255-c)+","+parseInt(255-a[e])+",255,1)",this.ctx.rotate(2*Math.PI/this.size),this.ctx.fillRect(b,0,a[e]/2,7);this.ctx.stroke();var g=this.Dots[0];g.cap-=.004*Math.PI;for(var e=0;8>e;e++)this.ctx.beginPath(),this.ctx.lineWidth=4,this.ctx.strokeStyle="rgba(255,"+parseInt(255-c)+","+parseInt(255-d[e])+",1)",this.ctx.arc(0,0,90-10*e,g.cap-d[e]/256*2*Math.PI/2,g.cap+d[e]/256*2*Math.PI/2,!1),this.ctx.stroke();this.ctx.translate(-this.width/2,-this.height/2)}};Player.init(),AudManager.init(),initPlaylist(),window.onload=function(){function a(){function a(a){switch(a){case 0:$(".loop").addClass("listing");break;case 1:$(".loop").addClass("single");break;case 2:$(".loop").addClass("random")}}function b(){var a=$("#footer").get(0).offsetTop-event.clientY-18;a=0>a?0:a>90?90:a,$(".volBtn").css("bottom",a+"px"),$(".currVol").css("height",a+3+"px"),AudManager.gain.gain.value=a/90,0===a?$(".volume").addClass("mute"):$(".volume").removeClass("mute")}$(".playBtn").on("click",function(){Player.isPause()?Player.play(Player.currentID):Player.pause()}),$(".nextBtn").on("click",function(){Player.next()}),$(".prevBtn").on("click",function(){Player.prev()}),$(".line").on({mousedown:function(a){$(Player.audioObj).unbind("timeupdate",c)},change:function(){isNaN(Player.audioObj.duration)||(Player.audioObj.currentTime=$(".line").val()*Player.audioObj.duration,Player.isPause||Player.audioObj.play()),l.relocateLyric(Player.audioObj.currentTime,0,l.labelTimes.length-1)},mouseup:function(){$(Player.audioObj).on("timeupdate",c)}}),$(".list ul").on("click",function(a){var b=a.target;"span"==b.nodeName.toLowerCase()&&(b=b.parentElement),$(".selected").removeClass("selected"),$(b).addClass("selected")}),$(".list ul").on("dblclick",function(a){var b=a.target;"span"==b.nodeName.toLowerCase()&&(b=b.parentElement),Player.play(b.getAttribute("data-id"))}),$(".volume").click(function(){"hidden"==$(".vol").get(0).style.visibility?($(".vol").get(0).style.visibility="visible",$(".vol").get(0).style.display="block"):($(".vol").get(0).style.visibility="hidden",$(".vol").get(0).style.display="none")}),$(".volGroove").on("mousedown",function(){b(),"volBtn"==event.target.className&&$(document).on({mousemove:function(a){b()},mouseup:function(){$(document).unbind("mousemove"),$(document).unbind("mouseup")}})}),a(Player.cycle),$(".loop").on("click",function(){$(this).removeClass("single"),$(this).removeClass("listing"),$(this).removeClass("random"),Player.setCycle(Player.cycle+1),a(Player.cycle)})}function b(){$(Player.audioObj).on({play:function(){$(".playBtn").addClass("playing"),$(".onplay").removeClass("onplay"),$(".list li[data-id="+Player.currentID+"]").addClass("onplay"),e(),$(".detail p").text(Player.playList[Player.currentID].name),l.loadLyric(Player.playList[Player.currentID].lyricUrl,function(){l.relocateLyric(Player.audioObj.currentTime,0,l.labelTimes.length-1)})},pause:function(){$(".playBtn").removeClass("playing")},timeupdate:function(){var a=Player.audioObj.currentTime,b=Player.audioObj.duration;$(".timeline p:eq(0)").text(Tools.toTime(a)),$(".timeline p:eq(1)").text(Tools.toTime(b))},ended:function(){Player.ended()},canplay:function(){}}),$(Player.audioObj).on("timeupdate",c),$(Player.audioObj).on("timeupdate",d)}function c(){$(".line").val(Player.audioObj.currentTime/Player.audioObj.duration)}function d(){l.scrollLyric()}function e(){var a=$(".list").get(0),b=parseInt($(".onplay").get(0).offsetTop-a.offsetHeight/2+30);Tools.addDomBufferAnimate(a,{scrollTop:b},20)}function f(){$(".list ul").html("");var a,b=Player.playList.length,c="";for(a=0;b>a;a++)c+="<li data-id ="+a+"><span>"+Tools.toDoubleDigits(a+1)+"</span>"+Player.playList[a].name+"</li>";$(".list ul").html(c)}function g(a,b){var c=$(".effect").get(0);document.documentElement.clientWidth<a?document.body.style.width=a+"px":document.body.style.width="100%",document.documentElement.clientHeight<b?document.body.style.height=b+"px":document.body.style.height="100%",k.width=c.offsetWidth,k.height=c.offsetHeight}function h(){$(".local").on("click",function(){$("#file").click()}),$("#file").on("change",function(){for(var a,b,c,d=0,e=0,g="",h="",a=0;a<this.files.length;a++){for(var i=!1,j=Player.playList.length,b=this.files[a],k=0;j>k;k++)b.name==Player.playList[k].name&&(i=!0,e++,h+=e+": "+b.name+"\n");i||(Player.audioObj.canPlayType(b.type)?(c=URL.createObjectURL(b),Player.add(b.name.slice(0,-4),c)):(d++,g+=d+": "+b.name+"\n"))}d>0&&(g="Following "+d+" file(s) upload failure!\n"+g),e>0&&(h="Following "+e+" file(s) are existed!\n"+h),(d>0||e>0)&&alert(g+h),f()})}function i(){$(".handle").on("click",function(){$(this).text().indexOf("HIDE")>-1?(Tools.addStyleBufferAnimate($(".musicList").get(0),{left:-250},30),$(this).text("SHOW")):(Tools.addStyleBufferAnimate($(".musicList").get(0),{left:0},30),$(this).text("HIDE"))}),$(".lyric").on("click",function(){0==$(this).val()?($(".lyr").show(),$(this).val(1)):($(".lyr").hide(),$(this).val(0))})}function j(){$(".effectStyle").on("click","div",function(){switch($(".effectStyle .checked").removeClass("checked"),$(this).addClass("checked"),$(this).text()){case"Column":Drawer.drawIndex=0;break;case"Bubble":Drawer.drawIndex=1;break;case"Phosphor":Drawer.drawIndex=2;break;case"Square":Drawer.drawIndex=3;break;case"Spiral":Drawer.drawIndex=5;break;default:Drawer.drawIndex=5}g(700,500),Drawer.init(k),Drawer.visualizer()}),$(".effectSize").on("click","div",function(){switch($(".effectSize .checked").removeClass("checked"),$(this).addClass("checked"),$(this).text()){case"16":Drawer.setSize(16);break;case"32":Drawer.setSize(32);break;case"64":Drawer.setSize(64);break;case"128":Drawer.setSize(128);break;case"256":Drawer.setSize(256);break;case"512":Drawer.setSize(512);break;case"1024":Drawer.setSize(1024);break;default:Drawer.setSize(64)}Drawer.visualizer()})}var k=$("#canvas").get(0);g(700,500),Drawer.init(k),a(),b(),f(),h(),i(),j(),Drawer.setSize(64),Drawer.visualizer(),window.onresize=function(){g(700,500),Drawer.init(k),Drawer.visualizer()},setInterval(function(){$(".logo").text("max-FPS:"+Monitor.maxFrame+"   | min-FPS:"+Monitor.minFrame+"   | cur-FPS:"+Monitor.currFrame)},1e3);var l={nthLine:0,labelTimes:[],currUrl:"",loadLyric:function(a,b){if(a&&this.currUrl!==a){var c=this;this.nthLine=0,this.currUrl=a,this.labelTimes=[],Tools.loadLyric(a,function(a){for(var d=/\[([0-9]{2})\:([0-9]{2})(\.)([0-9]{2})\]/,e=a.split("\n"),f="",g=0;g<e.length;g++){var h=d.exec(e[g]);h&&(c.labelTimes.push(c.labelTimeToSecns(h[0])),f+="<p>"+e[g].slice(h.index+10)+"</p>")}$(".lyricSlider").html(f),b&&b()},function(){$(".lyricSlider").html("<p class='noLyricTitle'>Load lyric failure!</p></br><a href='javascript:void(0)' class='noLyricUpload'>Upload the other lyric</a>")})}else a||$(".lyricSlider").html("<p class='noLyricTitle'>Can't find lyric!</p></br><a href='javascript:void(0)' class='noLyricUpload'>Upload a lyric</a>")},scrollLyric:function(){var a,b=this.labelTimes[this.nthLine],c=null,d=0;Player.audioObj.currentTime>b&&(a=$(".lyricSlider p:eq("+this.nthLine+")"),$(".playingLine").removeClass("playingLine"),a.addClass("playingLine"),c=$(".lyricBoard").get(0),d=parseInt(a.get(0).offsetTop-c.offsetHeight/2+25),d=0>d?0:d,Tools.addDomBufferAnimate(c,{scrollTop:d},20),this.nthLine++)},labelTimeToSecns:function(a){return parseFloat(60*a.slice(1,3))+parseFloat(a.slice(4,9))},relocateLyric:function(a,b,c){var d,e=Math.floor(b/2+c/2);return b==e?(this.nthLine=e,e):(d=this.labelTimes[e],d>a?this.relocateLyric(a,b,e):this.relocateLyric(a,e,c))}}};var Monitor={maxFrame:0,minFrame:9999,currFrame:0,currTime:0,elapseTime:0,_sTime:0,_sTFrame:0,start:function(){this.currTime=this._sTime=new Date},update:function(){var a=new Date;a-this._sTime>=1e3?(this.currFrame=this._sTFrame,this.maxFrame=this.currFrame>this.maxFrame?this.currFrame:this.maxFrame,this.minFrame=this.currFrame<this.minFrame?this.currFrame:this.minFrame,this._sTFrame=0,this._sTime=a):++this._sTFrame,this.elapseTime=a-this.currTime,this.currTime=a}};